phina.namespace(function(){phina.define("phina.glfilter.GLFilterLayer",{superClass:"phina.display.DisplayElement",renderChildBySelf:!0,canvas2d:null,renderer2d:null,textureCanvas:null,domElement:null,gl:null,backgroundColor:"white",init:function(e){this.superInit(),this.$extend(phina.glfilter.GLFilterLayer.defaultParams,e),this.canvas2d=phina.graphics.Canvas(),this.canvas2d.setSize(this.width,this.height),this.renderer2d=phina.display.CanvasRenderer(this.canvas2d),this.textureCanvas=phina.graphics.Canvas();var t=Math.max(this.width,this.height),i=Math.pow(2,Math.floor(Math.log(t)/Math.log(2))+1);this.textureCanvas.setSize(i,i),this.domElement=document.createElement("canvas"),this.domElement.width=i,this.domElement.height=i;var a=this.gl=this.domElement.getContext("webgl")||this.domElement.getContext("experimental-webgl");a.clearColor(0,0,0,0),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),this.headNode=phina.glfilter.SceneRenderNode(a,{width:i,height:i}),this.destNode=phina.glfilter.DestinationNode(a,{width:i,height:i}),this.headNode.connectTo(this.destNode)},draw:function(e){var t=this.textureCanvas;if(this.backgroundColor?(this.canvas2d.clearColor(this.backgroundColor),t.clearColor(this.backgroundColor)):(this.canvas2d.clear(),t.clear()),this.children.length>0)for(var i=this.children.slice(),a=0,n=i.length;n>a;++a)this.renderer2d.renderObject(i[a]);var s=this.canvas2d.domElement;t.context.drawImage(s,0,0,s.width,s.height,0,0,s.width,s.height),this.headNode.render(this.gl,t.domElement);var r=this.domElement;e.context.drawImage(r,0,0,s.width,s.height,0,0,e.width,e.height)},_static:{defaultParams:{width:640,height:960}}})}),phina.namespace(function(){phina.define("phina.glfilter.Screen",{frameBuffer:null,depthRenderBuffer:null,texture:null,init:function(e,t,i){this.width=t||512,this.height=i||512,this.frameBuffer=e.createFramebuffer(),this.texture=e.createTexture(),this.depthRenderBuffer=e.createRenderbuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),e.bindRenderbuffer(e.RENDERBUFFER,this.depthRenderBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.width,this.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthRenderBuffer),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null)}})}),phina.namespace(function(){phina.define("phina.glfilter.ShaderNode",{nextNode:null,screen:null,program:null,attributes:null,uniforms:null,_positionVbo:null,_uvVbo:null,init:function(e,t){this.$extend(phina.glfilter.ShaderNode.defaultParams,t),this.screen=this._createScreen(e,this.width,this.height),this._setupProgram(e),this._setupVbo(e)},_createScreen:function(e,t,i){return phina.glfilter.Screen(e,t,i)},connectTo:function(e){return this.nextNode=e,e},getAttributeData:function(){return[{name:"position",size:2},{name:"uv",size:2}]},getUniformData:function(){return[{name:"texture0",type:"texture"}]},getShaderSource:function(){return["precision mediump float;","uniform sampler2D texture0;","varying vec2 vUv;","void main(void) {","  gl_FragColor = texture2D(texture0, vUv);","}"].join("\n")},render:function(e,t){e.useProgram(this.program),this.setAttributes(e),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.texture),this.setUniform(e,"texture0",0),e.bindFramebuffer(e.FRAMEBUFFER,this.screen.frameBuffer),e.viewport(0,0,this.width,this.height),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.nextNode&&this.nextNode.render(e,this.screen)},setAttributes:function(e){var t=this.attributes.position;e.bindBuffer(e.ARRAY_BUFFER,this._positionVbo),e.enableVertexAttribArray(t.location),e.vertexAttribPointer(t.location,t.size,e.FLOAT,!1,0,0);var i=this.attributes.uv;e.bindBuffer(e.ARRAY_BUFFER,this._uvVbo),e.enableVertexAttribArray(i.location),e.vertexAttribPointer(i.location,i.size,e.FLOAT,!1,0,0)},setUniform:function(e,t,i){var a=this.uniforms[t];if(a)switch(e.useProgram(this.program),a.type){case"float":e.uniform1f(a.location,i);break;case"int":case"texture":e.uniform1i(a.location,i);break;case"vec2":e.uniform2fv(a.location,i);break;case"vec3":e.uniform3fv(a.location,i);break;case"vec4":case"color":e.uniform4fv(a.location,i);break;case"mat3":e.uniformMatrix3fv(a.location,!1,i);break;case"mat4":e.uniformMatrix4fv(a.location,!1,i)}},_setupProgram:function(t){var i=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(i,e),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(i));var a=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(a,this.getShaderSource()),t.compileShader(a),!t.getShaderParameter(a,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(a));var n=t.createProgram();if(t.attachShader(n,i),t.attachShader(n,a),t.linkProgram(n),t.useProgram(n),!t.getProgramParameter(n,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(n));this.attributes=this.getAttributeData().reduce(function(e,i){return e[i.name]={size:i.size,location:t.getAttribLocation(n,i.name)},e},{}),this.uniforms=this.getUniformData().reduce(function(e,i){return e[i.name]={type:i.type,location:t.getUniformLocation(n,i.name)},e},{}),this.program=n},_setupVbo:function(e){var t=new Float32Array([[-1,-1],[1,-1],[-1,1],[1,1]].flatten()),i=new Float32Array([[0,0],[1,0],[0,1],[1,1]].flatten());this._positionVbo=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._positionVbo),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this._uvVbo=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._uvVbo),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null)},_static:{defaultParams:{width:512,height:512}}});var e=["attribute vec2 position;","attribute vec2 uv;","varying vec2 vUv;","void main(void) {","  vUv = uv;","  gl_Position = vec4(position, 0.0, 1.0);","}"].join("\n")}),phina.namespace(function(){phina.define("phina.glfilter.SceneRenderNode",{superClass:"phina.glfilter.ShaderNode",init:function(e,t){this.superInit(e,t),this.texture0=e.createTexture()},render:function(e,t){e.useProgram(this.program),this.setAttributes(e),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D),this.setUniform(e,"texture0",0),e.bindFramebuffer(e.FRAMEBUFFER,this.screen.frameBuffer),e.viewport(0,0,this.width,this.height),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.nextNode&&this.nextNode.render(e,this.screen)}})}),phina.namespace(function(){phina.define("phina.glfilter.DestinationNode",{superClass:"phina.glfilter.ShaderNode",init:function(e,t){this.superInit(e,t)},_createScreen:function(){return null},connectTo:function(){return null},render:function(e,t){e.useProgram(this.program),this.setAttributes(e),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.texture),this.setUniform(e,"texture",0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.width,this.height),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.flush()}})}),phina.namespace(function(){phina.define("phina.glfilter.AlphaNode",{superClass:"phina.glfilter.ShaderNode",init:function(e,t){this.superInit(e,t)},getUniformData:function(){return[{name:"texture0",type:"texture"},{name:"color",type:"vec4"}]},getShaderSource:function(){return["precision mediump float;","uniform sampler2D texture0;","uniform vec4 color;","varying vec2 vUv;","void main(void) {","  vec4 tex = texture2D(texture0, vUv);","  vec3 c = color.rgb * color.a + tex.rgb * (1.0 - color.a);","  gl_FragColor = vec4(c, tex.a);","}"].join("\n")}})}),phina.namespace(function(){phina.define("phina.glfilter.SepiaNode",{superClass:"phina.glfilter.ShaderNode",init:function(e,t){this.superInit(e,t)},getShaderSource:function(){return["precision mediump float;","uniform sampler2D texture0;","varying vec2 vUv;","void main(void) {","  vec4 tex = texture2D(texture0, vUv);","  vec3 c = vec3((tex.r + tex.g + tex.b) / 3.0);","  gl_FragColor = vec4(c.r * 1.2, c.g * 1.05, c.b * 0.9, tex.a);","}"].join("\n")}})}),phina.namespace(function(){phina.define("phina.glfilter.MonotoneNode",{superClass:"phina.glfilter.ShaderNode",init:function(e,t){this.superInit(e,t)},getShaderSource:function(){return["precision mediump float;","uniform sampler2D texture0;","varying vec2 vUv;","void main(void) {","  vec4 tex = texture2D(texture0, vUv);","  vec3 c = vec3((tex.r + tex.g + tex.b) / 3.0);","  gl_FragColor = vec4(c.r, c.g, c.b, tex.a);","}"].join("\n")}})}),phina.namespace(function(){phina.define("phina.glfilter.ReverseNode",{superClass:"phina.glfilter.ShaderNode",init:function(e,t){this.superInit(e,t)},getShaderSource:function(){return["precision mediump float;","uniform sampler2D texture0;","varying vec2 vUv;","void main(void) {","  vec4 tex = texture2D(texture0, vUv);","  gl_FragColor = vec4(1.0 - tex.rgb, tex.a);","}"].join("\n")}})}),phina.namespace(function(){phina.define("phina.glfilter.ZoomBlurNode",{superClass:"phina.glfilter.ShaderNode",init:function(e,t){this.superInit(e,t)},getUniformData:function(){return[{name:"texture0",type:"texture"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"strength",type:"float"}]},getShaderSource:function(){return["precision mediump float;","uniform sampler2D texture0;","uniform float x;","uniform float y;","uniform float strength;","varying vec2 vUv;","const float nFrag = 1.0 / 30.0;","float rnd(vec3 scale, float seed){","    return fract(sin(dot(gl_FragCoord.stp + seed, scale)) * 43758.5453 + seed);","}","void main(void){","    vec2  center = vec2(x / {0}, 1.0 - y / {1});".format(e(this.width),e(this.height)),"    vec3  destColor = vec3(0.0);","    float random = rnd(vec3(12.9898, 78.233, 151.7182), 0.0);","    vec2  fcc = vUv - center;","    float totalWeight = 0.0;","    for(float i = 0.0; i <= 30.0; i++){","        float percent = (i + random) * nFrag;","        float weight = percent - percent * percent;","        vec2  t = vUv - fcc * percent * strength * nFrag;","        destColor += texture2D(texture0, t).rgb * weight;","        totalWeight += weight;","    }","    gl_FragColor = vec4(destColor / totalWeight, 1.0);","}"].join("\n")}});var e=function(e){return e%1?""+e:""+e+".0"}});var SCREEN_WIDTH=640,SCREEN_HEIGHT=960,SCREEN_CENTER_X=SCREEN_WIDTH/2,SCREEN_CENTER_Y=SCREEN_HEIGHT/2,Axis={x:new THREE.Vector3(1,0,0).normalize(),y:new THREE.Vector3(0,1,0).normalize(),z:new THREE.Vector3(0,0,1).normalize()},threeext=threeext||{};threeext.$method("extention",function(){THREE.$method("$extend",function(e,t){var i=Array.prototype.slice.call(arguments);return i.shift(),Array.prototype.forEach.call(i,function(i){for(var a in i)e[a]&&t[a]&&t[a].className&&"THREE."===t[a].className.substr(0,6)?e[a].copy(t[a]):e[a]=t[a]},this),e}),THREE.$method("$add",function(e,t){var i=Array.prototype.slice.call(arguments);return i.shift(),Array.prototype.forEach.call(i,function(i){for(var a in i)t[a]||(e[a]&&t[a]&&t[a].className&&"THREE."===t[a].className.substr(0,6)?e[a].add(t[a]):e[a]+=t[a])},this),e}),THREE.Mesh.prototype.$method("rotate",function(e,t,i){this.quaternion.rotate(e,t,i)}),THREE.Mesh.prototype.$method("move",function(e){return this.position.x=e.x,this.position.y=e.y,this.position.z=e.z,this}),THREE.Mesh.prototype.$method("deepclone",function(){return new this.constructor(this.geometry.clone(),this.material.clone()).copy(this)}),THREE.Mesh.prototype.getter("tweener",function(){return this._tweener||(this._tweener=phina.accessory.Tweener().attachTo(this)),this._tweener}),function(){var e=["addEventListener","on","removeEventListener","off","clearEventListener","clear","hasEventListener","has","dispatchEvent","fire","dispatchEventByType","flare","attach","attachTo","detach"];e.each(function(e){THREE.Mesh.prototype.$method(e,phina.app.Element.prototype[e])})}(),THREE.Mesh.prototype._listeners={},THREE.Vector3.prototype.className="THREE.Vector3",THREE.Quaternion.prototype.className="THREE.Quaternion",THREE.Quaternion.prototype.$method("rotate",function(e,t,i){if("THREE.Quaternion"===e.className){var a=e.clone();a.multiply(this.clone()),this.copy(a)}else this.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.x,e)),this.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.y,t)),this.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.z,i));return this}),THREE.PerspectiveCamera.prototype.$method("rotate",function(e){var t=e.clone();t.multiply(this.quaternion.clone()),this.quaternion.copy(t)}),THREE.PerspectiveCamera.prototype.$method("move",function(e){this.position.x=e.x,this.position.y=e.y,this.position.z=e.z}),THREE.MultiMaterial.prototype.accessor("opacity",{set:function(e){for(var t=0;t<this.materials.length;t++)this.materials[t].opacity=e},get:function(){return this.materials[0].opacity}})}),phina.define("fly.SimpleUpdater",{superClass:"phina.app.Element",init:function(){this.superInit(),this.elements=[]},update:function(){for(var e=0;e<this.elements.length;e++)this.elements[e].update()},get:function(e){return this.elements[e]},remove:function(e){this.elements.splice(e,1)},count:function(e){return this.elements.length}}),phina.define("fly.DirectionShape",{superClass:"phina.display.Shape",init:function(e){e={}.$safe(e,{backgroundColor:"transparent",fill:"#ff5050",stroke:"#aaa",strokeWidth:2,width:16,height:32}),this.superInit(e)},prerender:function(e){e.beginPath().moveTo(0,this.height).lineTo(this.width,-this.height).lineTo(-this.width,-this.height).closePath()}}),phina.define("fly.MarkShape",{superClass:"phina.display.Shape",init:function(e){e={}.$safe(e,{backgroundColor:"transparent",stroke:"#4448",strokeWidth:1,width:16,height:16}),this.superInit(e)},render:function(e){e.clearColor(this.backgroundColor),e.transformCenter(),this.isStrokable()&&(e.lineWidth=this.strokeWidth,e.strokeStyle=this.stroke,e.drawLine(-this.width,0,this.width,0),e.drawLine(0,-this.height,0,this.height))}}),phina.define("fly.asset.ThreeJSON",{superClass:"phina.asset.Asset",data:null,init:function(){this.superInit()},_load:function(e){var t=this;(new THREE.JSONLoader).load(this.src,function(i,a){t.data=new THREE.Mesh(i,new THREE.MeshFaceMaterial(a)),e(t)})},get:function(){return this.data.deepclone()}}),phina.define("fly.asset.ThreeTexture",{superClass:"phina.asset.Asset",_asset:null,init:function(){this.superInit()},_load:function(e){var t=this;(new THREE.TextureLoader).load(this.src,function(i){t._asset=i,e(t)})},get:function(){var e=this._asset.clone();return e.needsUpdate=!0,e}}),phina.define("fly.asset.ThreeCubeTex",{superClass:"phina.asset.Asset",_asset:null,init:function(){this.superInit()},_load:function(e){var t=this,a=this.src.split(" ",2),n=[];for(i=0;i<6;i++)n[i]=a[0]+i+a[1];(new THREE.CubeTextureLoader).load(n,function(i){var a=THREE.ShaderLib.cube;a.uniforms.tCube.value=i,t._asset=new THREE.Mesh(new THREE.BoxGeometry(1e4,1e4,1e4),new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:a.uniforms,depthWrite:!1,side:THREE.BackSide})),e(t)})},get:function(){return this._asset.clone()}}),phina.define("fly.asset.Stage",{superClass:"phina.asset.Asset",data:{},init:function(){this.superInit()},_load:function(e){var t=this,i=phina.asset.File();i.load({path:this.src,dataType:"json"}).then(function(){var a=i.data;a.$safe({enemys:[],obstacles:[],winds:[],messages:[],goals:[]});for(var n=0;n<a.enemys.length;n++)a.enemys[n].$safe({position:{},rotation:{},option:{},autospawn:{},random:{},killmes:{}}),a.enemys[n].autospawn.$safe({time:0,progress:0,random:{}}),a.enemys[n].autospawn.random.$safe({x:0,y:0,z:0}),a.enemys[n].killmes.$safe({time:0,text:"",offkill:!1}),a.enemys[n].option.$safe({position:new THREE.Vector3(a.enemys[n].position.x||0,a.enemys[n].position.y||0,a.enemys[n].position.z||0),quaternion:(new THREE.Quaternion).rotate(a.enemys[n].rotation.x||0,a.enemys[n].rotation.y||0,a.enemys[n].rotation.z||0),c:(new THREE.Quaternion).rotate(a.enemys[n].rotation.cx||0,a.enemys[n].rotation.cy||0,a.enemys[n].rotation.cz||0)});for(var n=0;n<a.winds.length;n++)a.winds[n].$safe({v:.2,x:0,y:0,color:[0,0,0]}),a.winds[n].position=new THREE.Vector2(a.winds[n].x,a.winds[n].y),a.winds[n].c=a.winds[n].color[0]<<16|a.winds[n].color[1]<<8|a.winds[n].color[2];for(var n=0;n<a.obstacles.length;n++)a.obstacles[n].$safe({position:{},rotation:{},scale:{}}),a.obstacles[n].position=new THREE.Vector3(a.obstacles[n].position.x||0,a.obstacles[n].position.y||0,a.obstacles[n].position.z||0),a.obstacles[n].quaternion=(new THREE.Quaternion).rotate(a.obstacles[n].rotation.x||0,a.obstacles[n].rotation.y||0,a.obstacles[n].rotation.z||0),a.obstacles[n].scale=new THREE.Vector3(a.obstacles[n].scale.x||100,a.obstacles[n].scale.y||100,a.obstacles[n].scale.z||100);for(var n=0;n<a.messages.length;n++)a.messages[n].$safe({time:0,text:""});for(var n=0;n<a.goals.length;n++)a.goals[n].$safe({x:0,y:0,z:0,size:100,kill:0,message:""});this.data=a,e(t)}.bind(this))},get:function(){return this.data}}),phina.asset.AssetLoader.assetLoadFunctions.threejson=function(e,t){var i=fly.asset.ThreeJSON(),a=i.load(t);return a},phina.asset.AssetLoader.assetLoadFunctions.threetexture=function(e,t){var i=fly.asset.ThreeTexture(),a=i.load(t);return a},phina.asset.AssetLoader.assetLoadFunctions.threecubetex=function(e,t){var i=fly.asset.ThreeCubeTex(),a=i.load(t);return a},phina.asset.AssetLoader.assetLoadFunctions.stage=function(e,t){var i=fly.asset.Stage(),a=i.load(t);return a},fly.colCup2D3=function(e,t,i,a,n){var s=t.clone().sub(e),r=a.clone().multiplyScalar(i.clone().dot(a)/a.clone().dot(a)).sub(i),o=r.clone().dot(r);if(1e-5>o){var h=t.clone().sub(e).length();h=Math.min(h,t.clone().add(a).sub(e).length()),h=Math.min(h,t.clone().sub(e.clone().add(i)).length()),h=Math.min(h,t.clone().add(a).sub(e.clone().add(i)).length());var l=t.clone().add(a.multiplyScalar(s.clone().dot(a)/a.clone().dot(a)*-1)),d=Math.min(h,l.sub(e).length())}else var c=a.clone().dot(a),p=Math.clamp(r.clone().dot(s.clone().dot(a)/c*a.clone().sub(s))/o,0,1),u=Math.clamp(i.clone().multiplyScalar(p).sub(s).dot(a)/c,0,1),d=t.clone().add(a.clone().multiplyScalar(u)).sub(e.clone().add(i.clone().multiplyScalar(p))).length();return n>=d},fly.colobbsphere=function(e,t,i,a,n){var s=new THREE.Vector3(0,0,0),r=t.clone().sub(e);if(i.x>0){var o=Axis.x.clone().applyQuaternion(a),h=Math.abs(r.dot(o)/i.x);h>1&&s.add((1-h)*i.x*o)}return i.y>0&&(o=Axis.y.clone().applyQuaternion(a),h=Math.abs(r.dot(o)/i.y),h>1&&s.add((1-h)*i.y*o)),i.z>0&&(o=Axis.z.clone().applyQuaternion(a),h=Math.abs(r.dot(o)/i.z),h>1&&s.add((1-h)*i.z*o)),s.length()<=n},phina.define("fly.Popup",{superClass:"phina.display.Shape",init:function(e){e={}.$safe(e,{backgroundColor:"transparent",fill:"hsla(0, 0%, 0%, 0.6)",stroke:null,strokeWidth:2,width:512,height:48,sideIndent:32}),this.superInit(e),this.sideIndent=e.sideIndent,this.label=phina.display.Label(e.label).addChildTo(this)},prerender:function(e){var t=this.width/2,i=this.height/2;e.beginPath().moveTo(-t,-i).lineTo(this.sideIndent-t,0).lineTo(-t,i).lineTo(t,i).lineTo(t-this.sideIndent,0).lineTo(t,-i).closePath()}}),phina.define("fly.EffectManager",{superClass:"fly.SimpleUpdater",init:function(e){this.superInit(),this.explodeManager=fly.ExplodeManager(e).addChildTo(this),this.rayManager=fly.RayManager(e).addChildTo(this),this.threescene=e},explode:function(e,t,i){return this.explodeManager.explode(e,t,i)},ray:function(e,t,i,a,n,s){return this.rayManager.ray(e,t,i,a,n,s)}}),phina.define("fly.ExplodeManager",{superClass:"fly.SimpleUpdater",init:function(e){this.superInit(),this.threescene=e},explode:function(e,t,i){var a=new THREE.ShaderMaterial({transparent:!0,uniforms:{tExplosion:{type:"t",value:phina.asset.AssetManager.get("threetexture","explode").get()},time:{type:"f",value:100*Math.random()},alpha:{type:"f",value:1}},vertexShader:phina.asset.AssetManager.get("text","expvertexshader").data,fragmentShader:phina.asset.AssetManager.get("text","expfragshader").data}),n=new THREE.Mesh(new THREE.IcosahedronGeometry(20,2),a).$safe({time:i,timeMax:i}).$safe({time:10,timeMax:10,update:function(){this.time--,a.uniforms.time.value+=.015*Math.random(),a.uniforms.alpha.value=this.time/this.timeMax}});return n.move(e),n.scale.set(t,t,t),this.threescene.add(n),this.elements.push(n),n},update:function(){for(var e=0;e<this.elements.length;e++)this.get(e).update(),0===this.get(e).time&&(this.get(e).parent.remove(this.get(e)),this.elements.splice(e,1),e--)}}),phina.define("fly.RayManager",{superClass:"fly.SimpleUpdater",init:function(e){this.superInit(),this.threescene=e},ray:function(e,t,i,a,n,s){var r=new THREE.Mesh(new THREE.SphereGeometry(a,20,10,0,2*Math.PI,0,Math.PI/2));r.position.set(0,-500,0);var o=new THREE.Mesh(new THREE.CylinderGeometry(a,a,1e3,20,10),new THREE.MeshBasicMaterial({color:t,opacity:i,transparent:!0})).$safe({time:s,timeMax:s,generator:e,length:500+n,update:function(){this.time--}});return o.geometry.merge(r.geometry),this.threescene.add(o),this.elements.push(o),o},update:function(){for(var e=0;e<this.count();e++)this.get(e).update(),this.get(e).move(this.get(e).generator.position.clone().add(Axis.z.clone().applyQuaternion(this.get(e).generator.quaternion).setLength(this.get(e).length))),this.get(e).quaternion.copy((new THREE.Quaternion).setFromAxisAngle(Axis.x,Math.PI/2)),this.get(e).quaternion.rotate(this.get(e).generator.quaternion),0===this.get(e).time&&(this.get(e).parent.remove(this.get(e)),this.elements.splice(e,1),e--)}}),phina.define("fly.EnemyManager",{superClass:"fly.SimpleUpdater",definedenemy:[],enemyraders:[],groups:[],killcount:0,allcount:0,init:function(e,t,i,a){this.superInit(),this.scene=e,this.threescene=t,this.gauge_boss_h=i,this.message=a,this.effectmanager=new fly.EffectManager(t).addChildTo(this)},defineEnemy:function(e){this.definedenemy[e]={mesh:phina.asset.AssetManager.get("threejson",e).get(),routine:this.enemys[e].routine.$safe({hp:5,size:1,v:0,c:new THREE.Quaternion,time:0,update:function(){}}),autospawn:(this.enemys[e].autospawn||{}).$safe({rep:1,options:{}})}},createEnemy:function(e,t,i,a,n){if(n)this.one("frame",function(s){s.progress>n&&this.createEnemy(e,t,i,a)}.bind(this));else{if(!a){var s=this.definedenemy[e].mesh.clone();THREE.$extend(s,this.definedenemy[e].routine),THREE.$extend(s,t),s.group=i,this.threescene.add(s),this.elements.push(s);var r=phina.display.CircleShape({radius:3,fill:"hsla(0, 80%, 60%, 0.5)",stroke:"hsla(0, 0%, 0%, 0.5)",strokeWidth:1}).addChildTo(this.scene),o=this.flyer.position.x/15-s.position.x/15,h=this.flyer.position.z/15-s.position.z/15,l=Math.min(Math.sqrt(Math.pow(o,2)+Math.pow(h,2)),75),d=Math.atan2(o,h)-this.flyer.myrot.y+(Math.abs(this.flyer.myrot.x)>Math.PI/2&&Math.abs(this.flyer.myrot.x)<1.5*Math.PI?Math.PI:0);return r.setPosition(SCREEN_WIDTH-100+Math.sin(d)*l,SCREEN_HEIGHT-100+Math.cos(d)*l),this.enemyraders.push(r),t.boss&&(this.scene.bosscoming=!0,this.scene.boss=s,this.gauge_boss_h.tweener.fadeIn(10).play(),this.gauge_boss_h.value=s.hp,this.gauge_boss_h.maxValue=s.hp),s}this.on("frame"+(this.scene.frame+a),function(){this.createEnemy(e,t,i)}.bind(this))}},createEnemyMulti:function(e,t,i,a){var n=i.$safe(this.definedenemy[e].autospawn);this.groups.push({num:n.rep,message:a||{}}),t.boss&&(this.scene.bossdefeated=!1);for(var s=0;s<n.rep;s++){var r={position:new THREE.Vector3};THREE.$extend(r,t),this.createEnemy(e,r,this.groups.last,n.time,n.progress),n.delay&&(n.time+=n.delay),THREE.$add(t,n.options),t.position.add(new THREE.Vector3(Math.random()*n.random.x*2-n.random.x,Math.random()*n.random.y*2-n.random.y,Math.random()*n.random.z*2-n.random.z))}this.allcount+=n.rep},update:function(){for(var e=0;e<this.count();e++){this.get(e).update(this);var t=this.flyer.position.x/15-this.get(e).position.x/15,i=this.flyer.position.z/15-this.get(e).position.z/15,a=Math.min(Math.sqrt(Math.pow(t,2)+Math.pow(i,2)),75),n=Math.atan2(t,i)-this.flyer.myrot.y+(Math.abs(this.flyer.myrot.x)>Math.PI/2&&Math.abs(this.flyer.myrot.x)<1.5*Math.PI?Math.PI:0);this.enemyraders[e].setPosition(SCREEN_WIDTH-100+Math.sin(n)*a,SCREEN_HEIGHT-100+Math.cos(n)*a),this.get(e).hp<=0&&(this.kill(e),e--)}},removeEnemy:function(e){if(this.get(e).group.num--,0===this.get(e).group.num){var t=this.get(e).group.message.text;this.get(e).group.message.offkill&&(this.message.text=""),""!==t&&(this.on("frame"+(this.scene.frame+(this.get(e).group.message.time-5)),function(){this.message.text=""}.bind(this)),this.on("frame"+(this.scene.frame+this.get(e).group.message.time),function(){this.message.text=t}.bind(this)))}this.get(e).parent.remove(this.get(e)),this.elements.splice(e,1),this.enemyraders[e].remove(),this.enemyraders.splice(e,1)},kill:function(e){this.effectmanager.explode(this.get(e).position,this.get(e).size,this.get(e).explodeTime),this.scene.score+=this.get(e).size,this.killcount++,this.removeEnemy(e)},enemys:{enem1:{filename:"enem-1",routine:{v:.6,chase:0,duration:100,mindist:0,update:function(e){if(e.flyer.position.equals(this.position)||0===this.chase||0===this.mindist)this.position.addScaledVector(Axis.z.clone().applyQuaternion(this.quaternion).normalize(),this.v);else{var t=e.flyer.position.clone().sub(this.position.clone()),i=this.v*Math.clamp(2*(t.length()-this.mindist)/this.mindist,-1,1);t.normalize(),this.quaternion.slerp((new THREE.Quaternion).setFromAxisAngle(Axis.z.clone().cross(t).normalize(),Math.acos(Axis.z.clone().dot(t))),this.chase),this.position.addScaledVector(Axis.z.clone().applyQuaternion(this.quaternion).normalize(),i)}this.time%this.duration===0&&e.enmBulletManager.createBullet({position:this.position,quaternion:this.quaternion,v:2,atk:70}),this.quaternion.rotate(this.c),this.time++}},autospawn:{rep:6,delay:15}},enem2:{filename:"enem-2",routine:{hp:45,v:1,size:15,chase:.1,mindist:500,duration:15,explodeTime:30,update:function(e){if(!e.flyer.position.equals(this.position)){var t=e.flyer.position.clone().sub(this.position.clone()),i=this.v*Math.clamp(2*(t.length()-this.mindist)/this.mindist,-1,1);t.normalize(),this.quaternion.slerp((new THREE.Quaternion).setFromAxisAngle(Axis.z.clone().cross(t).normalize(),Math.acos(Axis.z.clone().dot(t))),this.chase),this.position.addScaledVector(Axis.z.clone().applyQuaternion(this.quaternion).normalize(),i)}this.time%this.duration===0&&e.enmBulletManager.createBullet({position:this.position,quaternion:this.quaternion,v:3,size:1.5,atk:100}),this.time++}}},enem3:{filename:"enem-3",routine:{hp:500,v:.25,size:30,duration:1,r:.1,explodeTime:30,scale:new THREE.Vector3(2,2,2),update:function(e){this.rotate(this.c);var t=Axis.z.clone().applyQuaternion(this.quaternion).normalize();if(this.rotate((new THREE.Quaternion).setFromAxisAngle(t,this.r)),this.position.addScaledVector(Axis.z.clone().applyQuaternion(this.quaternion).normalize(),this.v),this.time%this.duration===0){var i=this.quaternion.clone().rotate((new THREE.Quaternion).setFromAxisAngle(Axis.x.clone().applyQuaternion(this.quaternion).normalize(),Math.PI));e.enmBulletManager.createBullet({position:this.position,quaternion:this.quaternion.clone().rotate((new THREE.Quaternion).setFromAxisAngle(i,Math.PI*(this.time%(8*this.duration)/this.duration/8)/20*(Math.random()+10))),size:.5,atk:50})}this.time++}}}}}),phina.define("fly.BulletManager",{superClass:"fly.SimpleUpdater",init:function(e){this.superInit(),this.threescene=e,this.bullet=phina.asset.AssetManager.get("threejson","bullet").get()},createBullet:function(e){var t=this.bullet.clone();return THREE.$extend(t,e).$safe({v:1,size:1,atk:1,update:function(){this.position.addScaledVector(Axis.z.clone().applyQuaternion(this.quaternion).normalize(),this.v)}}),this.threescene.add(t),this.elements.push(t),t},update:function(){for(var e=0;e<this.count();e++)this.get(e).update()},removeBullet:function(e){this.get(e).parent.remove(this.get(e)),this.elements.splice(e,1)}}),phina.define("fly.ObstacleManager",{superClass:"fly.SimpleUpdater",init:function(e){this.superInit(),this.threescene=e},createObstacle:function(e,t,i){var a=THREE.$extend(new THREE.Mesh(new THREE.BoxGeometry(i.x,i.y,i.z),new THREE.MeshPhongMaterial({color:"#888888"})),{position:e,quaternion:t,size:i});return this.threescene.add(a),this.elements.push(a),a},update:function(){},removeObstacle:function(e){this.get(e).parent.remove(this.get(e)),this.elements.splice(e,1)}}),phina.define("fly.WindManager",{superClass:"fly.SimpleUpdater",time:0,flyerposy:0,init:function(e){this.superInit(),this.threescene=e},createWind:function(e,t){var i={v:.2,size:100,position:new THREE.Vector2,winds:[],update:function(){}}.$extend(e);i.mesh=THREE.$extend(new THREE.Mesh(new THREE.RingGeometry(i.size-.4,i.size,50,5),new THREE.MeshBasicMaterial({color:t,side:THREE.DoubleSide})),{position:new THREE.Vector3(i.position.x,0,i.position.y)});for(var a=-1e4*Math.sign(i.v);Math.abs(a)<=1e4;a+=300*i.v)i.winds.push(i.mesh.clone()),i.winds.last.rotate(Math.PI/2,0,0),i.winds.last.position.y=this.flyerposy+a,this.threescene.add(i.winds.last);return this.elements.push(i),i},update:function(){for(var e=0;e<this.count();e++){this.time%30===0&&(this.get(e).winds.push(this.get(e).mesh.clone()),this.get(e).winds.last.rotate(Math.PI/2,0,0),this.get(e).winds.last.position.y=this.flyerposy-1e4*Math.sign(this.get(e).v),this.threescene.add(this.get(e).winds.last)),this.get(e).winds.first&&this.get(e).winds.first.parent&&Math.abs(this.get(e).winds.first.position.y-this.flyerposy)>1e4&&this.get(e).winds.first.parent.remove(this.get(e).winds.first);for(var t=0;t<this.get(e).winds.length;t++)this.get(e).winds[t].position.y+=10*this.get(e).v}this.time++},removeWind:function(e){for(var t=0;t<this.get(e).winds.length;t++)this.get(e).winds[t].parent.remove(this.get(e).winds[t]);this.elements.splice(e,1)}}),phina.define("fly.LoadingScene",{superClass:"phina.game.LoadingScene",init:function(e){e=(e||{}).$safe(fly.LoadingScene.defaults).$safe(phina.game.LoadingScene.defaults),this.superInit(e),this.gauge.animationTime=e.animationtime},_static:{defaults:{animationtime:500}}}),phina.define("fly.SplashLoadingScene",{superClass:"phina.display.CanvasScene",init:function(e){e=(e||{}).$safe(phina.game.LoadingScene.defaults),this.superInit(e);var t=phina.asset.Texture();t.load(phina.game.SplashScene.defaults.imageURL).then(function(){this.sprite=phina.display.Sprite(this.texture).addChildTo(this),this.sprite.setPosition(this.gridX.center(),this.gridY.center()),this.sprite.alpha=0,this.sprite.tweener.clear().to({alpha:1},500,"easeOutCubic").wait(1e3).to({alpha:0},500,"easeOutCubic").wait(250).call(function(){this.sprite.remove()},this)}.bind(this)),this.texture=t;var i=phina.asset.AssetLoader();i.onload=function(e){this.app.popScene()}.bind(this),i.load(e.assets)}}),phina.define("fly.SceneLoadingScene",{superClass:"phina.display.DisplayScene",init:function(e){e=(e||{}).$safe(fly.SceneLoadingScene.defaults),this.superInit(e),this.options=e,this.loadprogress=0,this.loadfrequenry=0},load:function(e){this.label=phina.display.Label({text:"Loading... 0%",fill:"hsla(0, 0%, 0%, 0.6)",fontSize:15}).addChildTo(this).setPosition(SCREEN_CENTER_X,SCREEN_CENTER_Y);for(var t=0;t<e.length;t++)for(var i=0;i<e[t].length;i++)this.loadfrequenry++;var a=function(){s=[];for(var t=0;t<e[n].length;t++)(function(){var i=phina.util.Flow(e[n][t].bind(this));i.then(function(){this.label.text="Loading... "+ ++this.loadprogress/this.loadfrequenry*100+"%",this.loadprogress===this.loadfrequenry&&this.removeChild(this.label)}.bind(this)),s.push(i)}).bind(this)()}.bind(this),n=0,s=[];for(a(),t=1;t<e.length;t++){var n=t;phina.util.Flow.all(s).then(a)}}}),phina.define("fly.TitleScene",{superClass:"phina.display.DisplayScene",frame:0,init:function(e){this.superInit(e);var t=function(){this.startframe=0,n.alphaNode=phina.glfilter.AlphaNode(n.gl,{width:n.domElement.width,
height:n.domElement.height}),n.zoomBlurNode=phina.glfilter.ZoomBlurNode(n.gl,{width:n.domElement.width,height:n.domElement.height}),n.zoomBlurNode.setUniform(n.gl,"x",SCREEN_CENTER_X),n.zoomBlurNode.setUniform(n.gl,"y",SCREEN_CENTER_Y);var e=function(){n.alphaNode.setUniform(n.gl,"color",[1,1,1,.025*this.startframe]),n.zoomBlurNode.setUniform(n.gl,"strength",.4*this.startframe),40===this.startframe?(n.headNode.connectTo(n.destNode),this.off("enterframe",e),this.exit({stage:i.stage,difficulty:i.difficulty})):this.startframe++}.bind(this);this.on("enterframe",e),n.headNode.connectTo(n.zoomBlurNode).connectTo(n.alphaNode).connectTo(n.destNode)}.bind(this),i={},a={title:{x:0,y:0,sub:[{type:"label",value:"flygame",x:this.gridX.center(),y:this.gridY.span(5),size:64},{type:"label",value:"Click start",x:this.gridX.center(),y:this.gridY.span(11),size:32},{type:"label",value:"Exit",x:this.gridX.span(2),y:this.gridY.span(15),size:32,callback:function(){history.back(),window.close()}},{type:"model",name:"flyer",value:phina.asset.AssetManager.get("threejson","fighter").get(),x:0,y:1e3,z:0},{type:"model",value:phina.asset.AssetManager.get("threecubetex","skybox").get(),x:0,y:1e3,z:0},{type:"model",value:new THREE.Mesh(new THREE.CircleGeometry(1e4,100),new THREE.MeshBasicMaterial({map:phina.asset.AssetManager.get("threetexture","plane").get()})),x:0,y:0,z:0,init:function(e){e.rotate(-Math.PI/2,0,0)}}]},main:{x:-500,y:-500,sub:[{type:"label",value:"Main Menu",x:this.gridX.center(),y:this.gridY.span(4),size:64},{type:"label",value:"Campaign",x:this.gridX.center(),y:this.gridY.span(6),size:32,link:"difficulty"},{type:"label",value:"Stage Select",x:this.gridX.center(),y:this.gridY.span(7),size:32,link:"stageselect"},{type:"label",value:"Tutorial",x:this.gridX.center(),y:this.gridY.span(8),size:32,link:"tutorial"},{type:"label",value:"Free Mode",x:this.gridX.center(),y:this.gridY.span(9),size:32,link:"difficulty",callback:function(){i.stage="arcade"}},{type:"label",value:"Settings",x:this.gridX.center(),y:this.gridY.span(10),size:32,link:"setting"},{type:"label",value:"Back",x:this.gridX.center(),y:this.gridY.span(12),size:32,link:"title"}]},tutorial:{x:750,y:750,sub:[{type:"label",value:"Tutorial",x:this.gridX.center(),y:this.gridY.span(4.5),size:64},{type:"label",value:"Move",x:this.gridX.center(),y:this.gridY.span(6.5),size:32,callback:function(){i.stage="tutorial_move",t()}},{type:"label",value:"Attack",x:this.gridX.center(),y:this.gridY.span(7.5),size:32,callback:function(){i.stage="tutorial_attack",t()}},{type:"label",value:"Special",x:this.gridX.center(),y:this.gridY.span(8.5),size:32,callback:function(){i.stage="tutorial_special",t()}},{type:"label",value:"Space",x:this.gridX.center(),y:this.gridY.span(9.5),size:32,callback:function(){i.stage="tutorial_space",t()}},{type:"label",value:"Back",x:this.gridX.center(),y:this.gridY.span(11.5),size:32,link:"main"}]},stageselect:{x:500,y:-250,sub:[{type:"label",value:"Stage Select",x:this.gridX.center(),y:this.gridY.span(4),size:64},{type:"label",value:"Main Menu",x:this.gridX.center(),y:this.gridY.span(12),size:32,link:"main"}]},difficulty:{x:-1e3,y:-750,sub:[{type:"label",value:"Difficulty",x:this.gridX.center(),y:this.gridY.span(5),size:64},{type:"label",value:"Easy",x:this.gridX.center(),y:this.gridY.span(7),size:32,callback:function(){i.difficulty=.5,t()}},{type:"label",value:"Normal",x:this.gridX.center(),y:this.gridY.span(8),size:32,callback:t},{type:"label",value:"Hard",x:this.gridX.center(),y:this.gridY.span(9),size:32,callback:function(){i.difficulty=1.5,t()}},{type:"label",value:"Back",x:this.gridX.center(),y:this.gridY.span(11),size:32,link:"main"}]},setting:{x:-250,y:-1250,sub:[{type:"label",value:"Setting",x:this.gridX.center(),y:this.gridY.span(4),size:64},{type:"label",value:"Credit",x:this.gridX.center(),y:this.gridY.span(8),size:32,link:"credit"},{type:"label",value:"Back",x:this.gridX.center(),y:this.gridY.span(12),size:32,link:"main"}]},credit:{x:-5e3,y:-5e3,sub:[{type:"label",value:"Credit",x:this.gridX.center(),y:this.gridY.span(4),size:64},{type:"label",value:"Programing: Shu",x:this.gridX.center(),y:this.gridY.span(6),size:32},{type:"label",value:"Back",x:this.gridX.center(),y:this.gridY.span(12),size:32,link:"setting"}]}},n=phina.glfilter.GLFilterLayer({width:SCREEN_WIDTH,height:SCREEN_HEIGHT}),s=phina.display.ThreeLayer({width:SCREEN_WIDTH,height:SCREEN_HEIGHT});s.setOrigin(0,0);var r=phina.display.DisplayElement(),o=new THREE.DirectionalLight(16777215,1);o.position.set(0,0,30),s.scene.add(o),s.scene.add(new THREE.AmbientLight(6316128)),s.update=function(e){this.flyer.quaternion.copy(new THREE.Quaternion),this.flyer.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.x,.25*Math.sin(.01*this.frame))),this.flyer.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.y,-Math.PI/2+.005*this.frame)),s.camera.position.copy(new THREE.Vector3(-r.x/15,1e3+r.y/15,100)),s.camera.updateMatrixWorld(),this.frame++}.bind(this),n.addChildTo(this),s.addChildTo(n),r.addChildTo(n);var h=function(e,t){r.position.distance(phina.geom.Vector2(e,t))>2e3?r.tweener.to({x:e,y:t},r.position.distance(phina.geom.Vector2(e,t))/3,"easeInOutQuint").play():r.tweener.to({x:e,y:t},1e3,"easeInOutCubic").play()};a.forIn(function(e,t){for(var i=0;i<t.sub.length;i++){var n=t.sub[i];if("label"===n.type){var o=phina.display.Label({x:n.x-t.x,y:n.y-t.y,text:n.value,fill:"hsla(0, 0%, 0%, 0.6)",stroke:!1,fontSize:n.size}).addChildTo(r);n.link&&(o.setInteractive(!0),phina.namespace(function(){var e=n.link;o.on("pointstart",function(){if(h(a[e].x,a[e].y),"title"===e){var t=function(){this.on("pointstart",l),this.off("enterframe",t)}.bind(this);this.on("enterframe",t)}}.bind(this))}.bind(this))),n.callback&&(o.setInteractive(!0),phina.namespace(function(){var e=n.callback;o.on("pointstart",function(){e()})}))}else"model"===n.type&&(s.scene.add(n.value),n.value.position.set(n.x,n.y,n.z),n.init&&n.init(n.value),n.name&&(this[n.name]=n.value))}}.bind(this));var l=function(){h(-500,-500),this.off("pointstart",l)};this.on("pointstart",l)}}),phina.define("fly.MainScene",{superClass:"fly.SceneLoadingScene",frame:0,progress:0,score:0,goaled:!1,bossdefeated:!0,init:function(e){this.stage=e.stage||"arcade",this.difficulty=e.difficulty||1,this.space=e.space||!1,this.superInit();var t=phina.glfilter.GLFilterLayer({width:SCREEN_WIDTH,height:SCREEN_HEIGHT}),i=phina.display.ThreeLayer({width:SCREEN_WIDTH,height:SCREEN_HEIGHT});i.setOrigin(0,0);var a=phina.display.CircleShape({x:SCREEN_WIDTH-100,y:SCREEN_HEIGHT-100,radius:75,fill:"hsla(0, 0%, 30%, 0.5)",stroke:null}),n=fly.DirectionShape({x:SCREEN_WIDTH-100,y:SCREEN_HEIGHT-100,fill:"hsla(0, 50%, 70%, 0.5)",stroke:"hsla(0, 0%, 0%, 0.5)",strokeWidth:1,width:2.5,height:4}),s=[],r=phina.ui.Gauge({x:80,y:SCREEN_HEIGHT-100,fill:"rgba(0, 0, 0, 0)",gaugeColor:"rgba(255, 64, 64, 0.3)",value:1e3,maxValue:1e3,strokeWidth:1,width:128,height:16}),o=phina.ui.Gauge({x:80,y:SCREEN_HEIGHT-80,fill:"rgba(0, 0, 0, 0)",gaugeColor:"rgba(64, 64, 255, 0.3)",value:1e3,maxValue:1e3,strokeWidth:1,width:128,height:16}),h=phina.ui.Gauge({x:this.gridX.center(),y:20,fill:"rgba(0, 0, 0, 0)",gaugeColor:"rgba(200, 16, 16, 0.3)",strokeWidth:1,width:SCREEN_WIDTH/1.2,height:16}),l=phina.display.RectangleShape({y:SCREEN_HEIGHT,fill:"hsla(0, 0%, 30%, 0.5)",stroke:"hsla(0, 0%, 30%, 0.25)",strokeWidth:1,cornerRadius:5,width:SCREEN_WIDTH/5,height:SCREEN_HEIGHT/12}),d=phina.display.Label({y:SCREEN_HEIGHT,text:"",fontSize:16,fill:"hsla(0, 0%, 0%, 0.6)",align:"left"}),c=phina.display.Label({x:this.gridX.center(),y:SCREEN_HEIGHT-20,text:"speed: 1",fontSize:12,fill:"hsla(0, 0%, 0%, 0.6)"}),p=fly.MarkShape({x:this.gridX.center(),y:this.gridY.center()}),u=fly.Popup({x:this.gridX.center(),y:this.gridY.center(),label:{text:"",fontSize:23,fill:"hsla(0, 0%, 0%, 0.8)"}}),f=[],m=[],g=phina.display.RectangleShape({x:this.gridX.center(),width:360,strokeWidth:0}),E=phina.display.Label({x:this.gridX.center(),text:"Result",fontSize:48,fill:"hsla(0, 0%, 0%, 0.8)"}),y=phina.display.Label({x:this.gridX.center(),text:"",fontSize:24,fill:"hsla(0, 0%, 0%, 0.8)"}),v=fly.EnemyManager(this,i.scene,h,d),x=v.effectmanager,T=fly.BulletManager(i.scene);v.enmBulletManager=T;var b=fly.ObstacleManager(i.scene),R=fly.WindManager(i.scene),w=phina.asset.AssetManager.get("threejson","fighter").get(),M=phina.asset.AssetManager.get("threecubetex","skybox").get(),S=new THREE.Mesh(new THREE.CircleGeometry(1e4,100),new THREE.MeshBasicMaterial({map:phina.asset.AssetManager.get("threetexture","plane").get()}));this.load([[function(e){w.position.y=1e3,w.material.opacity=.3,w.tweener.setUpdateType("fps"),w.$safe({speeds:[.1,.25,.45,.95],myrot:{x:0,y:0,z1:0,z2:0},row:0,yo:0,v:0,s1c:0,s2c:0,e:2e3,hp:1e3,speed:0,ups:15e-5,av:new THREE.Vector3,sub1id:0,sub2id:1,auto:1,update:function(e,t,i){if("arcade"!==i.stage&&0!==this.auto){var a=(e.x-SCREEN_CENTER_X)*(1-this.auto)-(i.goaled?-10:Math.max(Math.min(100*(Math.atan2(f.first.position.x-this.position.x,f.first.position.z-this.position.z)-this.myrot.y),100),-100)*this.auto);this.myrot.z1+=8e-5*a,this.yo+=8e-5*a;var n=i.goaled?50:0;this.row+=((e.y-SCREEN_CENTER_Y)*(1-this.auto)-Math.max(Math.min(100*(Math.atan2(f.first.position.y+n-this.position.y,phina.geom.Vector2(f.first.position.x-this.position.x,f.first.position.z-this.position.z).length())+this.myrot.x),100),-100)*this.auto)*this.ups}else{var a=e.x-SCREEN_CENTER_X;this.myrot.z1+=8e-5*a,this.yo+=8e-5*a,this.row+=(e.y-SCREEN_CENTER_Y)*this.ups}if(e.getPointing()&&(this.e--,i.space?this.av.addScaledVector(Axis.z.clone().applyQuaternion(this.quaternion).normalize(),this.speeds[this.speed]):this.v+=this.speeds[this.speed]),t.getKeyDown(68)&&(this.speed++,this.speed%=this.speeds.length,c.text="speed: "+(this.speed+1)),this.myrot.x+=.1*this.row,this.myrot.y-=.1*this.yo,this.myrot.x%=2*Math.PI,this.quaternion.copy(new THREE.Quaternion),this.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.z,this.myrot.z1+this.myrot.z2)),this.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.x,this.myrot.x)),this.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.y,this.myrot.y)),i.space||this.position.addScaledVector(Axis.z.clone().applyQuaternion(this.quaternion).normalize(),this.v+5),this.position.add(this.av),this.myrot.z1*=.95,this.locked=t.getKey(16),t.getKeyDown(16)&&(this.lock=Math.abs(this.myrot.x)<Math.PI/2||Math.abs(this.myrot.x)>1.5*Math.PI),(this.locked?this.lock:Math.abs(this.myrot.x)<Math.PI/2||Math.abs(this.myrot.x)>1.5*Math.PI)?(this.ups<15e-5&&(this.ups+=1e-5),this.myrot.z2*=.95):(this.ups>-15e-5&&(this.ups-=1e-5),this.myrot.z2+=.05*(Math.PI-this.myrot.z2)),this.yo*=.95,this.row*=.9,i.space?(this.v*=.995-1e-5*Math.abs(a)-(t.getKey(86)?.01:0),this.av.multiplyScalar(.995-(t.getKey(86)?.01:0))):(this.v*=.98-6e-5*Math.abs(a)-(t.getKey(86)?.05:0),this.av.multiplyScalar(.98-(t.getKey(86)?.05:0))),this.e>0){if(t.getKey(90)){this.e-=2;var s=this.quaternion.clone();s.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.x,.06*Math.random()-.03)),s.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.y,.06*Math.random()-.03));var h=this.quaternion.clone();h.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.x,.06*Math.random()-.03)),h.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.y,.06*Math.random()-.03)),this.attack(s,i),this.attack(h,i)}t.getKeyDown(88)&&0===this.s1c&&this.sub[this.sub1id](),t.getKeyDown(67)&&0===this.s2c&&this.sub[this.sub2id](),this.rgl>0&&(this.rgl--,this.beam(35,2,15,0,i)),this.brl>0&&(this.brl--,this.beam(25,3,25,30,i))}this.s1c>0&&this.s1c--,this.s2c>0&&this.s2c--,o.value=this.e,this.e<2e3&&(this.e+=4),r.value=this.hp;for(var l=0;l<R.elements.length;l++){var d=15+R.get(l).size,p=Math.sqrt(this.position.x*R.get(l).position.x+this.position.z*R.get(l).position.y);d>=p&&(this.av.y+=R.get(l).v/2)}for(var l=0;l<T.elements.length;l++)this.position.clone().sub(T.get(l).position).length()<5+T.get(l).size&&(x.explode(T.get(l).position,T.get(l).size,10),this.hp-=T.get(l).atk*i.difficulty,i.score--,T.removeBullet(l));for(var l=0;l<v.elements.length;l++){var u=Axis.z.clone().applyQuaternion(this.quaternion).setLength(54),m=Axis.z.clone().applyQuaternion(v.get(l).quaternion).setLength(v.get(l).size),g=this.position.clone().sub(u.clone().multiplyScalar(-.5)),E=v.get(l).position.clone().sub(m.clone().multiplyScalar(-.5));fly.colCup2D3(g,E,u,m,15+3*v.get(l).size)&&(x.explode(v.get(l).position,v.get(l).size,30),this.hp-=30*v.get(l).hp*i.difficulty/(this.v+1),i.score-=3,v.kill(l))}for(var l=0;l<b.elements.length;l++)fly.colobbsphere(b.get(l).position,this.position,b.get(l).size,b.get(l).quaternion,15)&&(this.hp=0);this.position.y<=0&&(this.hp=0)},sub:[function(){this.e>=250&&(this.s1c=20,this.rgl=2,this.e-=250,x.ray(this,16777215,.2,1,27,7),x.ray(this,65535,.2,2,27,5),x.ray(this,255,.2,4,27,3))}.bind(w),function(){this.e>=1500&&(this.s2c=250,this.brl=17,this.e-=1500,x.ray(this,16777215,.2,8,27,24),x.ray(this,16764108,.2,12,27,22),x.ray(this,16746632,.2,18,27,20),x.ray(this,16729156,.2,24,27,18),x.ray(this,16711680,.2,30,27,16))}.bind(w)],attack:function(e,t){var i=new THREE.Raycaster;i.set(this.position.clone(),Axis.z.clone().applyQuaternion(e).normalize());var a=i.intersectObjects(v.elements);0!==a.length&&(x.explode(a[0].point,1,10),a[0].object.hp-=5/t.difficulty)},beam:function(e,t,i,a,n){var s=Axis.z.clone().applyQuaternion(this.quaternion).normalize();if(0===a)var r=new THREE.Raycaster(this.position.clone(),s).intersectObjects(v.elements);else for(var r=[],o=0;o<v.elements.length;o++){var h=this.position.clone().add(s.multiplyScalar(27)),l=v.get(o).position,d=h.addScaledVector(s,h.clone().sub(l).negate().dot(s)/s.clone().dot(s)).sub(l).length();d<=a+5*v.get(o).size&&r.push({point:l.clone(),object:v.get(o)})}for(var o=0;o<r.length;o++)x.explode(r[o].point,t,i),r[o].object.hp-=e/n.difficulty}}),w.tweener.to({auto:0},750,"easeInCubic"),v.flyer=w,e()}],[function(e){if("arcade"!==this.stage){var t=function(){var t=phina.asset.AssetManager.get("stage",this.stage).get();u.label.text=t.name;for(var i=0;i<t.enemys.length;i++)v.definedenemy[t.enemys[i].name]||v.defineEnemy(t.enemys[i].name),v.createEnemyMulti(t.enemys[i].name,t.enemys[i].option,t.enemys[i].autospawn,t.enemys[i].killmes);for(var i=0;i<t.obstacles.length;i++)b.createObstacle(t.obstacles[i].position,t.obstacles[i].quaternion,t.obstacles[i].scale);for(var i=0;i<t.winds.length;i++)R.createWind({v:t.winds[i].v,position:t.winds[i].position,size:t.winds[i].size},t.winds[i].color);for(var i=0;i<t.messages.length;i++)!t.messages[i].progress||t.messages[i].progress<1e-5?phina.namespace(function(){var e=i;this.on("frame"+(t.messages[i].time-5),function(){d.text=""}.bind(this)),this.on("frame"+t.messages[i].time,function(){d.text=t.messages[e].text}.bind(this))}.bind(this)):phina.namespace(function(){var e=i;this.one("enterframe",function(){t.messages[e].progress<this.progress&&(this.on("frame"+(this.frame+t.messages[e].time-5),function(){d.text=""}.bind(this)),this.on("frame"+(this.frame+t.messages[e].time),function(){d.text=t.messages[e].text}.bind(this)))}.bind(this))}.bind(this));for(var i=0;i<t.goals.length;i++)phina.namespace(function(){var e=new THREE.ShaderMaterial({transparent:!0,uniforms:{tex1:{type:"t",value:phina.asset.AssetManager.get("threetexture","goal").get()},tex2:{type:"t",value:phina.asset.AssetManager.get("threetexture","goal_disable").get()},tex1_percentage:phina.app.Element().$safe({type:"f",value:0}).addChildTo(this),time:{type:"f",value:100*Math.random()},alpha:{type:"f",value:1}},vertexShader:phina.asset.AssetManager.get("text","goalvertexshader").data,fragmentShader:phina.asset.AssetManager.get("text","goalfragshader").data});f[i]=new THREE.Mesh(new THREE.IcosahedronGeometry(t.goals[i].size,2),e).$safe({size:t.goals[i].size,kill:t.goals[i].kill,message:t.goals[i].message,enable:!1,update:function(t){e.uniforms.time.value+=.005*Math.random(),this.enable||this===f.first&&(this!==f.last||t.bossdefeated)&&v.killcount>=v.allcount*this.kill&&(e.uniforms.tex1_percentage.tweener.to({value:1},50).play(),m.first.fill="hsla(190, 100%, 70%, 0.5)",this.enable=!0)}}),e.uniforms.tex1_percentage.tweener.setUpdateType("fps"),f[i].move(new THREE.Vector3(t.goals[i].x,t.goals[i].y,t.goals[i].z));var a=w.position.x/15-f[i].position.x/15,n=w.position.z/15-f[i].position.z/15,s=Math.min(Math.sqrt(Math.pow(a,2)+Math.pow(n,2)),75),r=Math.atan2(a,n)-w.myrot.y+(Math.abs(w.myrot.x)>Math.PI/2&&Math.abs(w.myrot.x)<1.5*Math.PI?Math.PI:0);m[i]=phina.display.CircleShape({radius:5,fill:"hsla(0, 0%, 70%, 0.5)",stroke:"hsla(0, 0%, 0%, 0.5)",strokeWidth:1}).setPosition(SCREEN_WIDTH-100+Math.sin(r)*s,SCREEN_HEIGHT-100+Math.cos(r)*s)}.bind(this));this.rate=t.rate,this.space=t.space,e()}.bind(this);if(phina.asset.AssetManager.get("stage",this.stage))t(),e();else{var i=phina.asset.AssetLoader(),a={stage:{}};a.stage[this.stage]="data/stages/"+this.stage+".min.json",i.load(a).then(function(){var e=phina.asset.AssetManager.get("stage",this.stage).get();if(a={threejson:{}},0!==e.enemys.length){for(var n=0;n<e.enemys.length;n++)phina.asset.AssetManager.get("threejson",e.enemys[n].name)||(a.threejson[e.enemys[n].name]="data/models/"+v.enemys[e.enemys[n].name].filename+".min.json");i.onload=t,i.load(a)}else t()}.bind(this))}}else{u.label.text="Free play";var i=phina.asset.AssetLoader(),a={threejson:{}};v.enemys.forIn(function(e,t){phina.asset.AssetManager.get("threejson",e)||(a.threejson[e]="data/models/"+t.filename+".min.json")}),i.load(a).then(function(){v.enemys.forIn(function(e){v.definedenemy[e]||v.defineEnemy(e)})}.bind(this)),e()}}],[function(e){t.addChildTo(this),t.alphaNode=phina.glfilter.AlphaNode(t.gl,{width:t.domElement.width,height:t.domElement.height});var f=function(){t.alphaNode.setUniform(t.gl,"color",[1,1,1,1-.025*this.frame]),40===this.frame&&(t.headNode.connectTo(t.destNode),this.off("enterframe",f))}.bind(this);this.on("enterframe",f),t.headNode.connectTo(t.alphaNode).connectTo(t.destNode),i.addChildTo(t),a.addChildTo(t),n.addChildTo(t),n.rotation=180;var x=u.canvas.context.createLinearGradient(0,-u.height/2,0,u.height/2);x.addColorStop(0,"hsla(0, 0%, 0%, 0.6)"),x.addColorStop(.5,"hsla(0, 0%, 0%, 0)"),x.addColorStop(1,"hsla(0, 0%, 0%, 0.6)"),u.fill=x,u.addChildTo(t),u.tweener2=phina.accessory.Tweener().attachTo(u),u.tweener.setUpdateType("fps"),u.tweener2.setUpdateType("fps"),u.tweener.set({width:0,height:72}).wait(10).to({width:720,height:3},100,"easeOutInCubic"),u.tweener2.set({alpha:0}).wait(10).fadeIn(30).wait(40).fadeOut(30);for(var b=0;4>b;b++)s[b]=fly.DirectionShape({x:SCREEN_WIDTH-100-75*Math.sin(b*Math.PI/2),y:SCREEN_HEIGHT-100-75*Math.cos(b*Math.PI/2),fill:"hsla(0, {0}%, {1}%, 0.5)".format(0===b?40:0,(0===b?10:0)+10),stroke:null,width:12,height:7.5}).addChildTo(t),s[b].rotation=90*-b;if(p.addChildTo(this),r.addChildTo(t),r.animation=!1,o.addChildTo(t),o.animation=!1,"arcade"!==this.stage){for(var b=0;b<m.length;b++)m[b].addChildTo(t);h.addChildTo(t),h.tweener.setUpdateType("fps"),h.alpha=0,h.animation=!1,l.addChildTo(t),l.live=0,d.addChildTo(t),x=g.canvas.context.createLinearGradient(0,-SCREEN_CENTER_Y,0,SCREEN_CENTER_Y),x.addColorStop(0,"hsla(0, 0%, 0%, 0.6)"),x.addColorStop(1,"hsla(0, 0%, 0%, 0)")}g.fill=x,g.addChildTo(t),E.addChildTo(t),y.addChildTo(t),g.tweener.setUpdateType("fps"),E.tweener.setUpdateType("fps"),y.tweener.setUpdateType("fps"),g.alpha=0,E.alpha=0,y.alpha=0,c.addChildTo(t),v.addChildTo(this),T.addChildTo(this),R.addChildTo(this),e()},function(e){var t=new THREE.DirectionalLight(16777215,1);if(t.position.set(0,0,30),M.update=function(){this.move(w.position)},S.update=function(){this.position.x=w.position.x,this.position.z=w.position.z},S.rotate(-Math.PI/2,0,0),"arcade"!==this.stage)for(var a=0;a<f.length;a++)f[a].tweener.setUpdateType("fps"),i.scene.add(f[a]);i.scene.add(t),i.scene.add(new THREE.AmbientLight(6316128)),i.scene.add(w),i.scene.add(M),i.scene.add(S),i.camera.radiuses=[-100,10,28],i.camera.radius=0,e()},function(e){i.update=function(e){var t=e.pointer,u=e.keyboard;if(w)if(this.goaled){w.flare("enterframe"),w.update(t,u,this),M.update(),S.update(),i.camera.quaternion.copy(new THREE.Quaternion),i.camera.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.z,-w.myrot.z2+(0!==i.camera.radius?-w.myrot.z1:0))),i.camera.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.x,-w.myrot.x)),i.camera.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.y,w.myrot.y+Math.PI));var x=Axis.z.clone().applyQuaternion(i.camera.quaternion).negate().setLength(i.camera.radiuses[i.camera.radius]);i.camera.position.copy(w.position.clone().add(x))}else{if("arcade"===this.stage){var b=Math.random();if(b>.98&&v.count()<100){if(.995>b)var C="enem1";else if(.9975>b)var C="enem2";else var C="enem3";v.createEnemyMulti(C,{position:new THREE.Vector3(Math.randint(-500,500),Math.randint(500,1500),Math.randint(-500,500)).add(w.position),quaternion:(new THREE.Quaternion).rotate(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2)},{random:{x:50,y:50,z:50}})}this.difficulty+=1e-4,v.count()>50&&v.removeEnemy(0)}else{for(var _=0;_<f.length;_++){var H=w.position.x/15-f[_].position.x/15,A=w.position.z/15-f[_].position.z/15,N=Math.min(Math.sqrt(Math.pow(H,2)+Math.pow(A,2)),75),z=Math.atan2(H,A)-w.myrot.y+(Math.abs(w.myrot.x)>Math.PI/2&&Math.abs(w.myrot.x)<1.5*Math.PI?Math.PI:0);m[_].setPosition(SCREEN_WIDTH-100+Math.sin(z)*N,SCREEN_HEIGHT-100+Math.cos(z)*N),f[_].update(this)}this.progress=w.position.clone().dot(f.last.position)/f.last.position.clone().dot(f.last.position),v.flare("frame",{progress:this.progress})}for(var _=0;_<T.elements.length;_++)T.get(_).position.clone().sub(w.position).length>800&&T.removeBullet(_);if(T.count()>1e3)for(var _=0;T.count()>500;_++)T.removeBullet(0);this.flare("frame"+this.frame),v.flare("frame"+this.frame),w.flare("enterframe"),w.update(t,u,this),M.update(),S.update(),R.flyerposy=w.position.y;for(var _=0;4>_;_++){var I=Math.abs(w.myrot.x)>Math.PI/2&&Math.abs(w.myrot.x)<1.5*Math.PI?1:0;s[_].setPosition(SCREEN_WIDTH-100-75*Math.sin(_*Math.PI/2-w.myrot.y+I*Math.PI),SCREEN_HEIGHT-100-75*Math.cos(_*Math.PI/2-w.myrot.y+I*Math.PI)),s[_].rotation=90*-_+w.myrot.y/Math.PI*180+180*I}u.getKeyDown(53)&&(i.camera.radius++,i.camera.radius%=i.camera.radiuses.length),i.camera.quaternion.copy(new THREE.Quaternion),i.camera.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.z,-w.myrot.z2+(0!==i.camera.radius?-w.myrot.z1:0))),i.camera.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.x,-w.myrot.x)),i.camera.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.y,w.myrot.y+Math.PI));var x=Axis.z.clone().applyQuaternion(i.camera.quaternion).negate().setLength(i.camera.radiuses[i.camera.radius]);i.camera.position.copy(w.position.clone().add(x)),this.bosscoming&&(null===this.boss.parent?(this.bosscoming=!1,h.tweener.fadeOut(10).play(),this.bossdefeated=!0):h.value=this.boss.hp),u.getKeyDown(32)&&(d.text="");var F=Axis.z.clone().applyQuaternion(w.quaternion).setLength(54),k=w.position.clone().sub(F.clone().multiplyScalar(-.5));if(w.hp<=0){if(v.effectmanager.explode(w.position,10,30),i.scene.remove(w),w=null,g.tweener.to({alpha:1,height:SCREEN_HEIGHT,y:SCREEN_CENTER_Y},5).play(),E.tweener.to({alpha:1,y:SCREEN_CENTER_Y/3},3).play(),y.tweener.wait(10).to({alpha:1,y:.6*SCREEN_CENTER_Y},3).play(),this.score<0&&(this.score=0),y.text="Score: "+this.score.toFixed(0)+"\nKill: "+v.killcount+"("+(v.killcount/v.allcount*100).toFixed(1)+"%)",E.text="Game Over",d.text="",a.tweener.fadeOut(20).play(),"arcade"!==this.stage)for(var _=0;_<m.length;_++)m[_].tweener.fadeOut(20).play();for(var _=0;_<v.count();_++)v.enemyraders[_].tweener.fadeOut(20).play();for(var _=0;4>_;_++)s[_].tweener.fadeOut(20).play();n.tweener.fadeOut(20).play(),r.tweener.fadeOut(20).play(),o.tweener.fadeOut(20).play(),l.tweener.fadeOut(20).play(),c.tweener.fadeOut(20).play(),p.tweener.fadeOut(20).play()}else if("arcade"!==this.stage&&f.first.enable&&fly.colCup2D3(k,f.first.position.clone(),F,new THREE.Vector3(0,0,0),15+f.first.size/2))if(1===f.length){w.tweener.to({auto:1},60).play(),g.tweener.to({alpha:1,height:SCREEN_HEIGHT,y:SCREEN_CENTER_Y},5).play(),E.tweener.to({alpha:1,y:SCREEN_CENTER_Y/3},3).play(),y.tweener.wait(10).to({alpha:1,y:.6*SCREEN_CENTER_Y},3).play();var P="";this.score+=this.rate[0]*w.hp/1e3,P=this.score>=this.rate[3]?"Perfect":this.score>=this.rate[2]?"Good":this.score>=this.rate[1]?"Middle":"Bad",this.score<0&&(this.score=0),y.text="Score: "+this.score.toFixed(0)+"\nKill: "+v.killcount+"("+(v.killcount/v.allcount*100).toFixed(1)+"%)\nLife: "+(w.hp/10).toFixed(1)+"%\nRate: "+P,d.text="",a.tweener.fadeOut(20).play();for(var _=0;_<m.length;_++)m[_].tweener.fadeOut(20).play();for(var _=0;_<v.count();_++)v.enemyraders[_].tweener.fadeOut(20).play();for(var _=0;4>_;_++)s[_].tweener.fadeOut(20).play();n.tweener.fadeOut(20).play(),r.tweener.fadeOut(20).play(),o.tweener.fadeOut(20).play(),l.tweener.fadeOut(20).play(),c.tweener.fadeOut(20).play(),p.tweener.fadeOut(20).play(),this.goaled=!0}else{var U=f.first.message;this.on("frame"+(this.frame+30),function(){d.text=U}.bind(this)),f.first.parent.remove(f.first),f.splice(0,1),m.first.remove(),m.splice(0,1)}this.frame%600===0&&this.score--,this.frame++}else i.camera.rotate((new THREE.Quaternion).setFromAxisAngle(Axis.y,-.002));""!==d.text?l.live<.99999&&(l.live+=.5,l.setPosition(SCREEN_CENTER_X*l.live,SCREEN_HEIGHT-.3*SCREEN_CENTER_Y*l.live),l.width=SCREEN_WIDTH/10+SCREEN_WIDTH/1.3*l.live,l.height=SCREEN_HEIGHT/12+SCREEN_HEIGHT/8*l.live,d.setPosition(.2*SCREEN_CENTER_X*l.live,SCREEN_HEIGHT-.3*SCREEN_CENTER_Y*l.live)):l.live>1e-5&&(l.live-=.5,l.setPosition(SCREEN_CENTER_X*l.live,SCREEN_HEIGHT-.3*SCREEN_CENTER_Y*l.live),l.width=SCREEN_WIDTH/10+SCREEN_WIDTH/1.3*l.live,l.height=SCREEN_HEIGHT/12+SCREEN_HEIGHT/5*l.live,d.setPosition(.2*SCREEN_CENTER_X*l.live,SCREEN_HEIGHT-.3*SCREEN_CENTER_Y*l.live)),i.camera.updateMatrixWorld()}.bind(this),e()}]])}}),phina.define("fly.MainSequence",{superClass:"phina.game.ManagerScene",init:function(){this.superInit({scenes:[{className:"fly.LoadingScene",arguments:{lie:!1,assets:{threejson:{fighter:"data/models/fighter-1.min.json",bullet:"data/models/bullet.min.json"},threetexture:{explode:"data/images/explosion.png",goal:"data/images/goal.png",goal_disable:"data/images/goal_disable.png",plane:"data/images/3.png"},threecubetex:{skybox:"data/images/skybox/ .png"},text:{expvertexshader:"data/glsl/expvertexshader.min.glsl",expfragshader:"data/glsl/expfragshader.min.glsl",goalvertexshader:"data/glsl/goalvertexshader.min.glsl",goalfragshader:"data/glsl/goalfragshader.min.glsl"}}}},{label:"title",className:"fly.TitleScene"},{label:"main",className:"fly.MainScene"}]})}}),phina.define("fly.Application",{superClass:"phina.display.CanvasApp",init:function(){this.superInit({width:SCREEN_WIDTH,height:SCREEN_HEIGHT,query:"#game",fit:!0}),threeext.extention(),this.replaceScene(fly.MainSequence())}}),phina.main(function(){var e=fly.Application();e.run()});